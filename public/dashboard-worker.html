<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Dashboard - HomeServices</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Language selector styling */
        .language-selector {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }

        #language-selector {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #333;
            font-size: 16px;
        }

        /* RTL support for Arabic */
        body[dir="rtl"] {
            direction: rtl;
            text-align: right;
        }

        /* Your existing CSS styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2, h3 {
            color: #333;
        }

        form {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="number"],
        input[type="time"],
        textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 10px 15px;
            background-color: #28a745;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #218838;
        }

        .message, .error {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }

        .message {
            background-color: #d4edda;
            color: #155724;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
        }

        .services-list {
            margin-top: 20px;
        }

        .service-item {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }

        .loading {
            color: #666;
        }
    </style>
</head>
<body class="dashboard-body">
    <!-- Navigation Bar -->
    <nav class="dashboard-nav">
        <div class="nav-brand" onclick="location.href='index.html'" data-translate="home">HomeServices</div>
        <div class="admin-info">
            <span id="adminName" data-translate="welcome">Welcome, <span id="adminNamePlaceholder">Loading...</span></span>
            <button onclick="logout()" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> <span data-translate="logout">Logout</span>
            </button>
        </div>
    </nav>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Main Content -->
        <main class="dashboard-main">
            <div class="container">
                <h2 data-translate="addService">Add a New Service</h2>
                <form id="add-service-form">
                    <!-- Hidden input for worker ID -->
                    <input type="hidden" id="worker-id" name="worker-id">

                    <label for="service-name" data-translate="serviceName">Service Name:</label>
                    <input type="text" id="service-name" name="service-name" required>

                    <label for="service-price" data-translate="servicePrice">Price ($):</label>
                    <input type="number" id="service-price" name="service-price" step="0.01" required>

                    <label for="availability-start" data-translate="availabilityStart">Availability Start Time:</label>
                    <input type="time" id="availability-start" name="availability-start" required>

                    <label for="availability-end" data-translate="availabilityEnd">Availability End Time:</label>
                    <input type="time" id="availability-end" name="availability-end" required>

                    <label for="service-description" data-translate="serviceDescription">Description:</label>
                    <textarea id="service-description" name="service-description" rows="4" required></textarea>

                    <button type="submit" id="submit-button" data-translate="addServiceButton">Add Service</button>
                </form>
                <div class="message" id="message"></div>
                <div class="error" id="error"></div>
            </div>

            <div class="services-list">
                <h3 data-translate="myServices">My Services</h3>
                <div id="services-container">
                    <p class="loading" data-translate="loadingServices">Loading services...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="dashboard-footer">
        <p data-translate="contactUs">Contact us: support@homeservices.com | +123 456 7890</p>
        <div class="social-media">
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
    </footer>

    <!-- Language Selector -->
    <div class="language-selector">
        <select id="language-selector" onchange="changeLanguage(this.value)">
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡ (Chinese)</option>
            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol (Spanish)</option>
            <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€ (Hindi)</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)</option>
            <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs (Portuguese)</option>
            <option value="bn">ğŸ‡§ğŸ‡© à¦¬à¦¾à¦‚à¦²à¦¾ (Bengali)</option>
            <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹ (Russian)</option>
            <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª (Japanese)</option>
            <option value="pa">ğŸ‡®ğŸ‡³ à¨ªà©°à¨œà¨¾à¨¬à©€ (Punjabi)</option>
            <option value="de">ğŸ‡©ğŸ‡ª Deutsch (German)</option>
            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais (French)</option>
        </select>
    </div>

    <script>
        // Define translations for all supported languages
        const translations = {
            en: {
                home: "HomeServices",
                welcome: "Welcome",
                logout: "Logout",
                addService: "Add a New Service",
                serviceName: "Service Name:",
                servicePrice: "Price ($):",
                availabilityStart: "Availability Start Time:",
                availabilityEnd: "Availability End Time:",
                serviceDescription: "Description:",
                addServiceButton: "Add Service",
                myServices: "My Services",
                loadingServices: "Loading services...",
                contactUs: "Contact us: support@homeservices.com | +123 456 7890"
            },
            zh: {
                home: "å®¶åº­æœåŠ¡",
                welcome: "æ¬¢è¿",
                logout: "ç™»å‡º",
                addService: "æ·»åŠ æ–°æœåŠ¡",
                serviceName: "æœåŠ¡åç§°ï¼š",
                servicePrice: "ä»·æ ¼ï¼ˆ$ï¼‰ï¼š",
                availabilityStart: "å¼€å§‹æ—¶é—´ï¼š",
                availabilityEnd: "ç»“æŸæ—¶é—´ï¼š",
                serviceDescription: "æè¿°ï¼š",
                addServiceButton: "æ·»åŠ æœåŠ¡",
                myServices: "æˆ‘çš„æœåŠ¡",
                loadingServices: "æ­£åœ¨åŠ è½½æœåŠ¡...",
                contactUs: "è”ç³»æˆ‘ä»¬ï¼šsupport@homeservices.com | +123 456 7890"
            },
            es: {
                home: "Servicios del Hogar",
                welcome: "Bienvenido",
                logout: "Cerrar sesiÃ³n",
                addService: "Agregar Nuevo Servicio",
                serviceName: "Nombre del Servicio:",
                servicePrice: "Precio ($):",
                availabilityStart: "Hora de Inicio:",
                availabilityEnd: "Hora de Fin:",
                serviceDescription: "DescripciÃ³n:",
                addServiceButton: "Agregar Servicio",
                myServices: "Mis Servicios",
                loadingServices: "Cargando servicios...",
                contactUs: "ContÃ¡ctenos: support@homeservices.com | +123 456 7890"
            },
            hi: {
                home: "à¤¹à¥‹à¤® à¤¸à¤°à¥à¤µà¤¿à¤¸à¥‡à¤œ",
                welcome: "à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆ",
                logout: "à¤²à¥‰à¤—à¤†à¤‰à¤Ÿ",
                addService: "à¤¨à¤ˆ à¤¸à¥‡à¤µà¤¾ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
                serviceName: "à¤¸à¥‡à¤µà¤¾ à¤•à¤¾ à¤¨à¤¾à¤®:",
                servicePrice: "à¤®à¥‚à¤²à¥à¤¯ ($):",
                availabilityStart: "à¤‰à¤ªà¤²à¤¬à¥à¤§à¤¤à¤¾ à¤ªà¥à¤°à¤¾à¤°à¤‚à¤­ à¤¸à¤®à¤¯:",
                availabilityEnd: "à¤‰à¤ªà¤²à¤¬à¥à¤§à¤¤à¤¾ à¤¸à¤®à¤¾à¤ªà¥à¤¤à¤¿ à¤¸à¤®à¤¯:",
                serviceDescription: "à¤µà¤¿à¤µà¤°à¤£:",
                addServiceButton: "à¤¸à¥‡à¤µà¤¾ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
                myServices: "à¤®à¥‡à¤°à¥€ à¤¸à¥‡à¤µà¤¾à¤à¤‚",
                loadingServices: "à¤¸à¥‡à¤µà¤¾à¤à¤‚ à¤²à¥‹à¤¡ à¤¹à¥‹ à¤°à¤¹à¥€ à¤¹à¥ˆà¤‚...",
                contactUs: "à¤¸à¤‚à¤ªà¤°à¥à¤• à¤•à¤°à¥‡à¤‚: support@homeservices.com | +123 456 7890"
            },
            ar: {
                home: "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„",
                welcome: "Ù…Ø±Ø­Ø¨Ø§Ù‹",
                logout: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",
                addService: "Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©",
                serviceName: "Ø§Ø³Ù… Ø§Ù„Ø®Ø¯Ù…Ø©:",
                servicePrice: "Ø§Ù„Ø³Ø¹Ø± ($):",
                availabilityStart: "ÙˆÙ‚Øª Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆÙØ±:",
                availabilityEnd: "ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªÙˆÙØ±:",
                serviceDescription: "Ø§Ù„ÙˆØµÙ:",
                addServiceButton: "Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø©",
                myServices: "Ø®Ø¯Ù…Ø§ØªÙŠ",
                loadingServices: "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª...",
                contactUs: "Ø§ØªØµÙ„ Ø¨Ù†Ø§: support@homeservices.com | +123 456 7890"
            },
            pt: {
                home: "ServiÃ§os DomÃ©sticos",
                welcome: "Bem-vindo",
                logout: "Sair",
                addService: "Adicionar Novo ServiÃ§o",
                serviceName: "Nome do ServiÃ§o:",
                servicePrice: "PreÃ§o ($):",
                availabilityStart: "Hora de InÃ­cio:",
                availabilityEnd: "Hora de TÃ©rmino:",
                serviceDescription: "DescriÃ§Ã£o:",
                addServiceButton: "Adicionar ServiÃ§o",
                myServices: "Meus ServiÃ§os",
                loadingServices: "Carregando serviÃ§os...",
                contactUs: "Contate-nos: support@homeservices.com | +123 456 7890"
            },
            bn: {
                home: "à¦¹à§‹à¦® à¦¸à¦¾à¦°à§à¦­à¦¿à¦¸à§‡à¦¸",
                welcome: "à¦¸à§à¦¬à¦¾à¦—à¦¤à¦®",
                logout: "à¦²à¦—à¦†à¦‰à¦Ÿ",
                addService: "à¦¨à¦¤à§à¦¨ à¦¸à§‡à¦¬à¦¾ à¦¯à§‹à¦— à¦•à¦°à§à¦¨",
                serviceName: "à¦¸à§‡à¦¬à¦¾à¦° à¦¨à¦¾à¦®:",
                servicePrice: "à¦®à§‚à¦²à§à¦¯ ($):",
                availabilityStart: "à¦‰à¦ªà¦²à¦¬à§à¦§à¦¤à¦¾à¦° à¦¶à§à¦°à§à¦° à¦¸à¦®à¦¯à¦¼:",
                availabilityEnd: "à¦‰à¦ªà¦²à¦¬à§à¦§à¦¤à¦¾à¦° à¦¶à§‡à¦· à¦¸à¦®à¦¯à¦¼:",
                serviceDescription: "à¦¬à¦¿à¦¬à¦°à¦£:",
                addServiceButton: "à¦¸à§‡à¦¬à¦¾ à¦¯à§‹à¦— à¦•à¦°à§à¦¨",
                myServices: "à¦†à¦®à¦¾à¦° à¦¸à§‡à¦¬à¦¾à¦¸à¦®à§‚à¦¹",
                loadingServices: "à¦¸à§‡à¦¬à¦¾à¦¸à¦®à§‚à¦¹ à¦²à§‹à¦¡ à¦¹à¦šà§à¦›à§‡...",
                contactUs: "à¦¯à§‹à¦—à¦¾à¦¯à§‹à¦— à¦•à¦°à§à¦¨: support@homeservices.com | +123 456 7890"
            },
            ru: {
                home: "Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½Ğ¸Ğµ Ğ£ÑĞ»ÑƒĞ³Ğ¸",
                welcome: "Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
                logout: "Ğ’Ñ‹Ğ¹Ñ‚Ğ¸",
                addService: "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞĞ¾Ğ²ÑƒÑ Ğ£ÑĞ»ÑƒĞ³Ñƒ",
                serviceName: "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ£ÑĞ»ÑƒĞ³Ğ¸:",
                servicePrice: "Ğ¦ĞµĞ½Ğ° ($):",
                availabilityStart: "Ğ’Ñ€ĞµĞ¼Ñ ĞĞ°Ñ‡Ğ°Ğ»Ğ°:",
                availabilityEnd: "Ğ’Ñ€ĞµĞ¼Ñ ĞĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ:",
                serviceDescription: "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:",
                addServiceButton: "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ£ÑĞ»ÑƒĞ³Ñƒ",
                myServices: "ĞœĞ¾Ğ¸ Ğ£ÑĞ»ÑƒĞ³Ğ¸",
                loadingServices: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑƒÑĞ»ÑƒĞ³...",
                contactUs: "Ğ¡Ğ²ÑĞ¶Ğ¸Ñ‚ĞµÑÑŒ Ñ Ğ½Ğ°Ğ¼Ğ¸: support@homeservices.com | +123 456 7890"
            },
            ja: {
                home: "ãƒ›ãƒ¼ãƒ ã‚µãƒ¼ãƒ“ã‚¹",
                welcome: "ã‚ˆã†ã“ã",
                logout: "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ",
                addService: "æ–°è¦ã‚µãƒ¼ãƒ“ã‚¹è¿½åŠ ",
                serviceName: "ã‚µãƒ¼ãƒ“ã‚¹å:",
                servicePrice: "æ–™é‡‘ ($):",
                availabilityStart: "é–‹å§‹æ™‚é–“:",
                availabilityEnd: "çµ‚äº†æ™‚é–“:",
                serviceDescription: "èª¬æ˜:",
                addServiceButton: "ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¿½åŠ ",
                myServices: "ãƒã‚¤ã‚µãƒ¼ãƒ“ã‚¹",
                loadingServices: "ã‚µãƒ¼ãƒ“ã‚¹ã‚’èª­ã¿è¾¼ã¿ä¸­...",
                contactUs: "ãŠå•ã„åˆã‚ã›: support@homeservices.com | +123 456 7890"
            },
            pa: {
                home: "à¨˜à¨° à¨¸à©‡à¨µà¨¾à¨µà¨¾à¨‚",
                welcome: "à¨œà©€ à¨†à¨‡à¨†à¨‚ à¨¨à©‚à©°",
                logout: "à¨²à©Œà¨—à¨†à¨‰à¨Ÿ",
                addService: "à¨¨à¨µà©€à¨‚ à¨¸à©‡à¨µà¨¾ à¨¸à¨¼à¨¾à¨®à¨² à¨•à¨°à©‹",
                serviceName: "à¨¸à©‡à¨µà¨¾ à¨¦à¨¾ à¨¨à¨¾à¨®:",
                servicePrice: "à¨•à©€à¨®à¨¤ ($):",
                availabilityStart: "à¨‰à¨ªà¨²à¨¬à¨§à¨¤à¨¾ à¨¸à¨¼à©à¨°à©‚ à¨¸à¨®à¨¾à¨‚:",
                availabilityEnd: "à¨‰à¨ªà¨²à¨¬à¨§à¨¤à¨¾ à¨…à©°à¨¤ à¨¸à¨®à¨¾à¨‚:",
                serviceDescription: "à¨µà©‡à¨°à¨µà¨¾:",
                addServiceButton: "à¨¸à©‡à¨µà¨¾ à¨¸à¨¼à¨¾à¨®à¨² à¨•à¨°à©‹",
                myServices: "à¨®à©‡à¨°à©€à¨†à¨‚ à¨¸à©‡à¨µà¨¾à¨µà¨¾à¨‚",
                loadingServices: "à¨¸à©‡à¨µà¨¾à¨µà¨¾à¨‚ à¨²à©‹à¨¡ à¨¹à©‹ à¨°à¨¹à©€à¨†à¨‚ à¨¹à¨¨...",
                contactUs: "à¨¸à©°à¨ªà¨°à¨• à¨•à¨°à©‹: support@homeservices.com | +123 456 7890"
            },
            de: {
                home: "Hausdienstleistungen",
                welcome: "Willkommen",
                logout: "Abmelden",
                addService: "Neue Dienstleistung HinzufÃ¼gen",
                serviceName: "Dienstleistungsname:",
                servicePrice: "Preis ($):",
                availabilityStart: "VerfÃ¼gbarkeit Beginn:",
                availabilityEnd: "VerfÃ¼gbarkeit Ende:",
                serviceDescription: "Beschreibung:",
                addServiceButton: "Dienstleistung HinzufÃ¼gen",
                myServices: "Meine Dienstleistungen",
                loadingServices: "Dienstleistungen werden geladen...",
                contactUs: "Kontakt: support@homeservices.com | +123 456 7890"
            },
            fr: {
                home: "Services Ã  Domicile",
                welcome: "Bienvenue",
                logout: "DÃ©connexion",
                addService: "Ajouter un Nouveau Service",
                serviceName: "Nom du Service:",
                servicePrice: "Prix ($):",
                availabilityStart: "Heure de DÃ©but:",
                availabilityEnd: "Heure de Fin:",
                serviceDescription: "Description:",
                addServiceButton: "Ajouter le Service",
                myServices: "Mes Services",
                loadingServices: "Chargement des services...",
                contactUs: "Contactez-nous: support@homeservices.com | +123 456 7890"
            }
        };

        // Function to change language
        function changeLanguage(language) {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[language] && translations[language][key]) {
                    element.textContent = translations[language][key];
                }
            });

            // Update text direction for RTL languages (e.g., Arabic)
            if (language === "ar") {
                document.body.setAttribute("dir", "rtl");
            } else {
                document.body.setAttribute("dir", "ltr");
            }
        }

        // Initialize with default language (English)
        document.addEventListener('DOMContentLoaded', () => {
            changeLanguage('en');
        });

        // Function to fetch the worker's ID based on the logged-in user's email
        async function fetchWorkerId() {
            try {
                console.log('Fetching worker ID...');
                const response = await fetch('/auth/user', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                const data = await response.json();

                if (response.ok) {
                    console.log('Worker ID fetched successfully:', data.user.id);
                    // Set the worker ID in the hidden input field
                    document.getElementById('worker-id').value = data.user.id;
                    return data.user.id; // Return the worker ID
                } else {
                    console.error('Failed to fetch worker ID:', data.message);
                    document.getElementById('error').textContent = 'Failed to fetch worker ID.';
                    return null;
                }
            } catch (error) {
                console.error('Error fetching worker ID:', error);
                document.getElementById('error').textContent = 'Error fetching worker ID.';
                return null;
            }
        }

        // Function to fetch and display the worker's services
        async function fetchWorkerServices() {
            try {
                console.log('Fetching worker services...');
                const workerId = document.getElementById('worker-id').value;
                const response = await fetch(`/api/worker/services?worker_id=${workerId}`);
                const data = await response.json();

                const servicesContainer = document.getElementById('services-container');
                servicesContainer.innerHTML = ''; // Clear existing content

                if (response.ok) {
                    console.log('Services fetched successfully:', data);
                    if (data.length > 0) {
                        data.forEach(service => {
                            const serviceItem = document.createElement('div');
                            serviceItem.className = 'service-item';
                            serviceItem.innerHTML = `
                                <strong>${service.name}</strong><br>
                                Price: $${service.price}<br>
                                Availability: ${service.availability_start} - ${service.availability_end}<br>
                                Status: ${service.status}<br>
                                Description: ${service.description}
                            `;
                            servicesContainer.appendChild(serviceItem);
                        });
                    } else {
                        servicesContainer.innerHTML = '<p>No services found.</p>';
                    }
                } else {
                    console.error('Failed to fetch services:', data.message);
                    servicesContainer.innerHTML = '<p class="error">Failed to fetch services. Please try again.</p>';
                }
            } catch (error) {
                console.error('Error fetching services:', error);
                document.getElementById('services-container').innerHTML = '<p class="error">An error occurred while fetching services.</p>';
            }
        }

        // Handle form submission to add a new service
        document.getElementById('add-service-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitButton = document.getElementById('submit-button');
            submitButton.disabled = true; // Disable the button to prevent multiple submissions

            const workerId = document.getElementById('worker-id').value;
            const serviceName = document.getElementById('service-name').value;
            const servicePrice = document.getElementById('service-price').value;
            const availabilityStart = document.getElementById('availability-start').value;
            const availabilityEnd = document.getElementById('availability-end').value;
            const serviceDescription = document.getElementById('service-description').value;

            // Ensure all fields are filled
            if (!serviceName || !servicePrice || !availabilityStart || !availabilityEnd || !serviceDescription) {
                document.getElementById('error').textContent = 'All fields are required.';
                submitButton.disabled = false;
                return;
            }

            try {
                const response = await fetch('/api/worker/services', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        worker_id: workerId,
                        rate_per_hour: servicePrice,
                        availability_start: availabilityStart,
                        availability_end: availabilityEnd,
                        description: serviceDescription,
                        is_active: 1 // Default to active
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('message').textContent = 'Service added successfully!';
                    document.getElementById('error').textContent = '';

                    // Clear the form fields
                    document.getElementById('add-service-form').reset();

                    // Refresh the list of services
                    fetchWorkerServices();
                } else {
                    document.getElementById('error').textContent = data.message || 'Failed to add service.';
                    document.getElementById('message').textContent = '';
                }
            } catch (error) {
                console.error('Error adding service:', error);
                document.getElementById('error').textContent = 'Failed to add service due to an error.';
                document.getElementById('message').textContent = '';
            } finally {
                submitButton.disabled = false; // Re-enable the button
            }
        });

        // Logout function
        async function logout() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('No token found. You are already logged out.');
                    window.location.href = '/login.html';
                    return;
                }

                const response = await fetch('/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include', // Ensure cookies are sent with the request
                });

                if (response.ok) {
                    localStorage.removeItem('token'); // Clear the token from localStorage
                    window.location.href = '/login.html'; // Redirect to the login page
                } else {
                    const result = await response.json();
                    alert(result.message || 'Logout failed. Please try again.');
                }
            } catch (error) {
                console.error('Error during logout:', error);
                alert('An error occurred while logging out.');
            }
        }

        // Load initial data
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('DOM fully loaded and parsed');
            // Fetch the worker's ID based on the logged-in user's email
            const workerId = await fetchWorkerId();

            if (workerId) {
                console.log('Worker ID found:', workerId);
                // Set the worker ID in the hidden input field
                document.getElementById('worker-id').value = workerId;

                // Fetch and display the worker's services
                fetchWorkerServices();
            } else {
                console.error('Failed to fetch worker ID.');
                document.getElementById('error').textContent = 'Failed to fetch worker ID.';
            }
        });
    </script>
</body>
</html>