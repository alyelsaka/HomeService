<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Dashboard - HomeServices</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Language selector styling */
        .language-selector {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }

        #language-selector {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: #fff;
            color: #333;
            font-size: 16px;
        }

        /* RTL support for Arabic */
        body[dir="rtl"] {
            direction: rtl;
            text-align: right;
        }
    </style>
</head>
<body class="dashboard-body">
    <!-- Navigation Bar -->
    <nav class="dashboard-nav">
        <div class="nav-brand" onclick="location.href='index.html'" data-translate="home">HomeServices</div>
        <div class="client-info">
            <span id="clientName" data-translate="welcome">Welcome, <span id="clientNamePlaceholder">Loading...</span></span>
            <button onclick="logout()" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> <span data-translate="logout">Logout</span>
            </button>
        </div>
    </nav>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <div class="profile-section">
                <div class="profile-image">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="client-status">
                    <span id="currentStatus" class="status-badge active" data-translate="active">Active</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <button class="nav-item active" onclick="showSection('serviceSearch')">
                    <i class="fas fa-search"></i> <span data-translate="serviceSearch">Service Search</span>
                </button>
                <button class="nav-item" onclick="showSection('bookings')">
                    <i class="fas fa-calendar-alt"></i> <span data-translate="myBookings">My Bookings</span>
                </button>
                <button class="nav-item" onclick="showSection('reviews')">
                    <i class="fas fa-star"></i> <span data-translate="reviews">Reviews</span>
                </button>
                <button class="nav-item" onclick="showSection('payments')">
                    <i class="fas fa-credit-card"></i> <span data-translate="paymentMethods">Payment Methods</span>
                </button>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Service Search Section -->
            <section id="serviceSearch" class="dashboard-section active">
                <h2 data-translate="serviceSearch">Service Search</h2>
                <div class="search-bar">
                    <input type="text" id="serviceSearchInput" placeholder="Search for services..." data-translate="searchPlaceholder">
                    <button onclick="searchServices()"><i class="fas fa-search"></i></button>
                </div>
                <div id="servicesContainer" class="services-grid">
                    <p data-translate="loadingServices">Loading services...</p>
                </div>
            </section>

            <!-- My Bookings Section -->
            <section id="bookings" class="dashboard-section">
                <h2 data-translate="myBookings">My Bookings</h2>
                <div id="bookingsContainer" class="bookings-grid">
                    <p data-translate="loadingBookings">Loading bookings...</p>
                </div>
            </section>

            <!-- Reviews Section -->
            <section id="reviews" class="dashboard-section">
                <h2 data-translate="reviews">Reviews</h2>
                <div id="reviewsContainer" class="reviews-grid">
                    <p data-translate="loadingReviews">Loading reviews...</p>
                </div>
            </section>

            <!-- Payment Methods Section -->
            <section id="payments" class="dashboard-section">
                <h2 data-translate="paymentMethods">Payment Methods</h2>
                <div id="paymentsContainer" class="payments-grid">
                    <p data-translate="loadingPayments">Loading payment methods...</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Footer -->
    <footer class="dashboard-footer">
        <p data-translate="contactUs">Contact us: support@homeservices.com | +123 456 7890</p>
        <div class="social-media">
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
    </footer>

    <!-- Language Selector -->
    <div class="language-selector">
        <select id="language-selector" onchange="changeLanguage(this.value)">
            <option value="en">ЁЯЗ║ЁЯЗ╕ English</option>
            <option value="zh">ЁЯЗиЁЯЗ│ ф╕нцЦЗ (Chinese)</option>
            <option value="es">ЁЯЗкЁЯЗ╕ Espa├▒ol (Spanish)</option>
            <option value="hi">ЁЯЗоЁЯЗ│ рд╣рд┐рдиреНрджреА (Hindi)</option>
            <option value="ar">ЁЯЗ╕ЁЯЗж ╪з┘Д╪╣╪▒╪и┘К╪й (Arabic)</option>
            <option value="pt">ЁЯЗ╡ЁЯЗ╣ Portugu├кs (Portuguese)</option>
            <option value="bn">ЁЯЗзЁЯЗй ржмрж╛ржВрж▓рж╛ (Bengali)</option>
            <option value="ru">ЁЯЗ╖ЁЯЗ║ ╨а╤Г╤Б╤Б╨║╨╕╨╣ (Russian)</option>
            <option value="ja">ЁЯЗпЁЯЗ╡ цЧецЬмшкЮ (Japanese)</option>
            <option value="pa">ЁЯЗоЁЯЗ│ рикрй░риЬри╛римрйА (Punjabi)</option>
            <option value="de">ЁЯЗйЁЯЗк Deutsch (German)</option>
            <option value="fr">ЁЯЗлЁЯЗ╖ Fran├зais (French)</option>
        </select>
    </div>

    <script>
        // Define translations for all supported languages
        const translations = {
            en: {
                home: "HomeServices",
                welcome: "Welcome",
                logout: "Logout",
                active: "Active",
                serviceSearch: "Service Search",
                myBookings: "My Bookings",
                reviews: "Reviews",
                paymentMethods: "Payment Methods",
                searchPlaceholder: "Search for services...",
                loadingServices: "Loading services...",
                loadingBookings: "Loading bookings...",
                loadingReviews: "Loading reviews...",
                loadingPayments: "Loading payment methods...",
                contactUs: "Contact us: support@homeservices.com | +123 456 7890"
            },
            zh: {
                home: "хо╢х║нцЬНхКб",
                welcome: "цмвш┐О",
                logout: "чЩ╗хЗ║",
                active: "ц┤╗ш╖Г",
                serviceSearch: "цЬНхКбцРЬч┤в",
                myBookings: "цИСчЪДщвДшов",
                reviews: "шпДшо║",
                paymentMethods: "цФпф╗ШцЦ╣х╝П",
                searchPlaceholder: "цРЬч┤вцЬНхКб...",
                loadingServices: "цнгхЬихКаш╜╜цЬНхКб...",
                loadingBookings: "цнгхЬихКаш╜╜щвДшов...",
                loadingReviews: "цнгхЬихКаш╜╜шпДшо║...",
                loadingPayments: "цнгхЬихКаш╜╜цФпф╗ШцЦ╣х╝П...",
                contactUs: "шБФч│╗цИСф╗м: support@homeservices.com | +123 456 7890"
            },
            es: {
                home: "Servicios del Hogar",
                welcome: "Bienvenido",
                logout: "Cerrar sesi├│n",
                active: "Activo",
                serviceSearch: "B├║squeda de Servicios",
                myBookings: "Mis Reservas",
                reviews: "Rese├▒as",
                paymentMethods: "M├йtodos de Pago",
                searchPlaceholder: "Buscar servicios...",
                loadingServices: "Cargando servicios...",
                loadingBookings: "Cargando reservas...",
                loadingReviews: "Cargando rese├▒as...",
                loadingPayments: "Cargando m├йtodos de pago...",
                contactUs: "Cont├бctenos: support@homeservices.com | +123 456 7890"
            },
            hi: {
                home: "рд╣реЛрдо рд╕рд░реНрд╡рд┐рд╕реЗрдЬ",
                welcome: "рд╕реНрд╡рд╛рдЧрдд рд╣реИ",
                logout: "рд▓реЙрдЧрдЖрдЙрдЯ",
                active: "рд╕рдХреНрд░рд┐рдп",
                serviceSearch: "рд╕реЗрд╡рд╛ рдЦреЛрдЬ",
                myBookings: "рдореЗрд░реА рдмреБрдХрд┐рдВрдЧ",
                reviews: "рд╕рдореАрдХреНрд╖рд╛рдПрдВ",
                paymentMethods: "рднреБрдЧрддрд╛рди рд╡рд┐рдзрд┐рдпрд╛рдВ",
                searchPlaceholder: "рд╕реЗрд╡рд╛рдПрдВ рдЦреЛрдЬреЗрдВ...",
                loadingServices: "рд╕реЗрд╡рд╛рдПрдВ рд▓реЛрдб рд╣реЛ рд░рд╣реА рд╣реИрдВ...",
                loadingBookings: "рдмреБрдХрд┐рдВрдЧ рд▓реЛрдб рд╣реЛ рд░рд╣реА рд╣реИрдВ...",
                loadingReviews: "рд╕рдореАрдХреНрд╖рд╛рдПрдВ рд▓реЛрдб рд╣реЛ рд░рд╣реА рд╣реИрдВ...",
                loadingPayments: "рднреБрдЧрддрд╛рди рд╡рд┐рдзрд┐рдпрд╛рдВ рд▓реЛрдб рд╣реЛ рд░рд╣реА рд╣реИрдВ...",
                contactUs: "рд╣рдорд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ: support@homeservices.com | +123 456 7890"
            },
            ar: {
                home: "╪о╪п┘Е╪з╪к ╪з┘Д┘Е┘Ж╪▓┘Д",
                welcome: "┘Е╪▒╪н╪и┘Л╪з",
                logout: "╪к╪│╪м┘К┘Д ╪з┘Д╪о╪▒┘И╪м",
                active: "┘Ж╪┤╪╖",
                serviceSearch: "╪и╪н╪л ╪╣┘Ж ╪з┘Д╪о╪п┘Е╪з╪к",
                myBookings: "╪н╪м┘И╪▓╪з╪к┘К",
                reviews: "╪з┘Д╪к┘В┘К┘К┘Е╪з╪к",
                paymentMethods: "╪╖╪▒┘В ╪з┘Д╪п┘Б╪╣",
                searchPlaceholder: "╪з╪и╪н╪л ╪╣┘Ж ╪з┘Д╪о╪п┘Е╪з╪к...",
                loadingServices: "╪м╪з╪▒┘Н ╪к╪н┘Е┘К┘Д ╪з┘Д╪о╪п┘Е╪з╪к...",
                loadingBookings: "╪м╪з╪▒┘Н ╪к╪н┘Е┘К┘Д ╪з┘Д╪н╪м┘И╪▓╪з╪к...",
                loadingReviews: "╪м╪з╪▒┘Н ╪к╪н┘Е┘К┘Д ╪з┘Д╪к┘В┘К┘К┘Е╪з╪к...",
                loadingPayments: "╪м╪з╪▒┘Н ╪к╪н┘Е┘К┘Д ╪╖╪▒┘В ╪з┘Д╪п┘Б╪╣...",
                contactUs: "╪з╪к╪╡┘Д ╪и┘Ж╪з: support@homeservices.com | +123 456 7890"
            },
            pt: {
                home: "Servi├зos Dom├йsticos",
                welcome: "Bem-vindo",
                logout: "Sair",
                active: "Ativo",
                serviceSearch: "Pesquisa de Servi├зos",
                myBookings: "Minhas Reservas",
                reviews: "Avalia├з├╡es",
                paymentMethods: "M├йtodos de Pagamento",
                searchPlaceholder: "Pesquisar servi├зos...",
                loadingServices: "Carregando servi├зos...",
                loadingBookings: "Carregando reservas...",
                loadingReviews: "Carregando avalia├з├╡es...",
                loadingPayments: "Carregando m├йtodos de pagamento...",
                contactUs: "Contate-nos: support@homeservices.com | +123 456 7890"
            },
            bn: {
                home: "рж╣рзЛржо рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж╕",
                welcome: "рж╕рзНржмрж╛ржЧрждржо",
                logout: "рж▓ржЧржЖржЙржЯ",
                active: "рж╕ржХрзНрж░рж┐ржпрж╝",
                serviceSearch: "рж╕рж╛рж░рзНржнрж┐рж╕ ржЕржирзБрж╕ржирзНржзрж╛ржи",
                myBookings: "ржЖржорж╛рж░ ржмрзБржХрж┐ржВ",
                reviews: "ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛",
                paymentMethods: "ржкрзЗржорзЗржирзНржЯ ржкржжрзНржзрждрж┐",
                searchPlaceholder: "рж╕рж╛рж░рзНржнрж┐рж╕ ржЕржирзБрж╕ржирзНржзрж╛ржи ржХрж░рзБржи...",
                loadingServices: "рж╕рж╛рж░рзНржнрж┐рж╕ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...",
                loadingBookings: "ржмрзБржХрж┐ржВ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...",
                loadingReviews: "ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...",
                loadingPayments: "ржкрзЗржорзЗржирзНржЯ ржкржжрзНржзрждрж┐ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...",
                contactUs: "ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рзБржи: support@homeservices.com | +123 456 7890"
            },
            ru: {
                home: "╨Ф╨╛╨╝╨░╤И╨╜╨╕╨╡ ╨г╤Б╨╗╤Г╨│╨╕",
                welcome: "╨Ф╨╛╨▒╤А╨╛ ╨┐╨╛╨╢╨░╨╗╨╛╨▓╨░╤В╤М",
                logout: "╨Т╤Л╨╣╤В╨╕",
                active: "╨Р╨║╤В╨╕╨▓╨╜╤Л╨╣",
                serviceSearch: "╨Я╨╛╨╕╤Б╨║ ╨г╤Б╨╗╤Г╨│",
                myBookings: "╨Ь╨╛╨╕ ╨С╤А╨╛╨╜╨╕╤А╨╛╨▓╨░╨╜╨╕╤П",
                reviews: "╨Ю╤В╨╖╤Л╨▓╤Л",
                paymentMethods: "╨Ь╨╡╤В╨╛╨┤╤Л ╨Ю╨┐╨╗╨░╤В╤Л",
                searchPlaceholder: "╨Я╨╛╨╕╤Б╨║ ╤Г╤Б╨╗╤Г╨│...",
                loadingServices: "╨Ч╨░╨│╤А╤Г╨╖╨║╨░ ╤Г╤Б╨╗╤Г╨│...",
                loadingBookings: "╨Ч╨░╨│╤А╤Г╨╖╨║╨░ ╨▒╤А╨╛╨╜╨╕╤А╨╛╨▓╨░╨╜╨╕╨╣...",
                loadingReviews: "╨Ч╨░╨│╤А╤Г╨╖╨║╨░ ╨╛╤В╨╖╤Л╨▓╨╛╨▓...",
                loadingPayments: "╨Ч╨░╨│╤А╤Г╨╖╨║╨░ ╨╝╨╡╤В╨╛╨┤╨╛╨▓ ╨╛╨┐╨╗╨░╤В╤Л...",
                contactUs: "╨б╨▓╤П╨╢╨╕╤В╨╡╤Б╤М ╤Б ╨╜╨░╨╝╨╕: support@homeservices.com | +123 456 7890"
            },
            ja: {
                home: "уГЫуГ╝уГауВ╡уГ╝уГУуВ╣",
                welcome: "уВИуБЖуБУуБЭ",
                logout: "уГнуВ░уВвуВжуГИ",
                active: "уВвуВпуГЖуВгуГЦ",
                serviceSearch: "уВ╡уГ╝уГУуВ╣цдЬч┤в",
                myBookings: "ф║Ич┤Дф╕Ашжз",
                reviews: "уГмуГУуГеуГ╝",
                paymentMethods: "цФпцЙХуБДцЦ╣ц│Х",
                searchPlaceholder: "уВ╡уГ╝уГУуВ╣уВТцдЬч┤в...",
                loadingServices: "уВ╡уГ╝уГУуВ╣уВТшкнуБ┐ш╛╝уБ┐ф╕н...",
                loadingBookings: "ф║Ич┤ДуВТшкнуБ┐ш╛╝уБ┐ф╕н...",
                loadingReviews: "уГмуГУуГеуГ╝уВТшкнуБ┐ш╛╝уБ┐ф╕н...",
                loadingPayments: "цФпцЙХуБДцЦ╣ц│ХуВТшкнуБ┐ш╛╝уБ┐ф╕н...",
                contactUs: "уБКхХПуБДхРИуВПуБЫ: support@homeservices.com | +123 456 7890"
            },
            pa: {
                home: "риШри░ ри╕рйЗри╡ри╛ри╡ри╛риВ",
                welcome: "риЬрйА риЖриЗриЖриВ риирйВрй░",
                logout: "ри▓рйМриЧриЖриЙриЯ",
                active: "ри╕ри░риЧри░рио",
                serviceSearch: "ри╕рйЗри╡ри╛ риЦрйЛриЬ",
                myBookings: "риорйЗри░рйАриЖриВ римрйБриХри┐рй░риЧри╛риВ",
                reviews: "ри╕риорйАриЦри┐риЖри╡ри╛риВ",
                paymentMethods: "ринрйБриЧридри╛рии ри╡ри┐ризрйАриЖриВ",
                searchPlaceholder: "ри╕рйЗри╡ри╛ри╡ри╛риВ риЦрйЛриЬрйЛ...",
                loadingServices: "ри╕рйЗри╡ри╛ри╡ри╛риВ ри▓рйЛриб ри╣рйЛ ри░ри╣рйАриЖриВ ри╣рии...",
                loadingBookings: "римрйБриХри┐рй░риЧри╛риВ ри▓рйЛриб ри╣рйЛ ри░ри╣рйАриЖриВ ри╣рии...",
                loadingReviews: "ри╕риорйАриЦри┐риЖри╡ри╛риВ ри▓рйЛриб ри╣рйЛ ри░ри╣рйАриЖриВ ри╣рии...",
                loadingPayments: "ринрйБриЧридри╛рии ри╡ри┐ризрйАриЖриВ ри▓рйЛриб ри╣рйЛ ри░ри╣рйАриЖриВ ри╣рии...",
                contactUs: "ри╕ри╛рибрйЗ риири╛ри▓ ри╕рй░рикри░риХ риХри░рйЛ: support@homeservices.com | +123 456 7890"
            },
            de: {
                home: "Hausdienstleistungen",
                welcome: "Willkommen",
                logout: "Abmelden",
                active: "Aktiv",
                serviceSearch: "Dienstesuche",
                myBookings: "Meine Buchungen",
                reviews: "Bewertungen",
                paymentMethods: "Zahlungsmethoden",
                searchPlaceholder: "Dienste suchen...",
                loadingServices: "Dienste werden geladen...",
                loadingBookings: "Buchungen werden geladen...",
                loadingReviews: "Bewertungen werden geladen...",
                loadingPayments: "Zahlungsmethoden werden geladen...",
                contactUs: "Kontaktieren Sie uns: support@homeservices.com | +123 456 7890"
            },
            fr: {
                home: "Services ├а Domicile",
                welcome: "Bienvenue",
                logout: "D├йconnexion",
                active: "Actif",
                serviceSearch: "Recherche de Services",
                myBookings: "Mes R├йservations",
                reviews: "Avis",
                paymentMethods: "M├йthodes de Paiement",
                searchPlaceholder: "Rechercher des services...",
                loadingServices: "Chargement des services...",
                loadingBookings: "Chargement des r├йservations...",
                loadingReviews: "Chargement des avis...",
                loadingPayments: "Chargement des m├йthodes de paiement...",
                contactUs: "Contactez-nous: support@homeservices.com | +123 456 7890"
            }
        };

        // Function to change language
        function changeLanguage(language) {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[language] && translations[language][key]) {
                    element.textContent = translations[language][key];
                }
            });

            // Update text direction for RTL languages (e.g., Arabic)
            if (language === "ar") {
                document.body.setAttribute("dir", "rtl");
            } else {
                document.body.setAttribute("dir", "ltr");
            }
        }

        // Initialize with default language (English)
        document.addEventListener('DOMContentLoaded', () => {
            changeLanguage('en');
        });

        // Fetch client details on page load
        async function fetchClientDetails() {
            try {
                const response = await fetch('/auth/user', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                const data = await response.json();
                document.getElementById('clientNamePlaceholder').textContent = data.user.name;
            } catch (error) {
                console.error('Error fetching client details:', error);
            }
        }

        // Fetch available services
        async function searchServices() {
            const container = document.getElementById('servicesContainer');
            container.innerHTML = '<p data-translate="loadingServices">Loading services...</p>';
            try {
                const response = await fetch('/auth/services/available', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                const services = await response.json();
                container.innerHTML = ''; // Clear existing content
                services.forEach(service => {
                    const card = document.createElement('div');
                    card.classList.add('service-card');
                    card.setAttribute('data-service-id', service.id); // Add data attribute for service ID
                    card.innerHTML = `
                        <div class="service-header">
                            <h3>${service.name}</h3>
                        </div>
                        <div class="service-details">
                            <p><i class="fas fa-tools"></i> Service Type: ${service.service_type}</p>
                            <p><i class="fas fa-money-bill-wave"></i> Price: $${service.price}</p>
                            <p><i class="fas fa-user"></i> Worker: ${service.worker_name}</p>
                        </div>
                        <div class="service-actions">
                            <button onclick="bookService(${service.id}, ${service.worker_id})">Book Now</button>
                        </div>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error fetching services:', error);
                container.innerHTML = '<p data-translate="loadingServices">Failed to load services. Please try again later.</p>';
            }
        }

        // Book a service
      // Book a service
async function bookService(serviceId, workerId) {
    try {
        const requestBody = {
            service_id: serviceId,
            worker_id: workerId,
            booking_date: new Date().toISOString().split('T')[0], // Current date in YYYY-MM-DD format
            start_time: '09:00', // Default start time
            end_time: '17:00',   // Default end time
            rate_per_hour: 50    // Default rate per hour
        };

        console.log('Request Body:', requestBody); // Log the request body

        const response = await fetch('/api/bookings', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestBody)
        });

        const result = await response.json();

        if (response.ok) {
            alert(result.message || 'Service booked successfully!');

            // Remove the booked service from the DOM
            const serviceCard = document.querySelector(`.service-card[data-service-id="${serviceId}"]`);
            if (serviceCard) {
                serviceCard.remove();
            }

            loadBookings(); // Refresh the bookings list
        } else {
            console.error('Booking failed:', result); // Log the error response
            alert(result.message || 'Failed to book service.');
        }
    } catch (error) {
        console.error('Error booking service:', error); // Log the full error
        alert('An error occurred while booking the service.');
    }
}
        // Fetch client bookings
        async function loadBookings() {
            try {
                const response = await fetch('/bookings', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                const bookings = await response.json();
                console.log('Bookings Data:', bookings); // Log the bookings data

                const container = document.getElementById('bookingsContainer');
                container.innerHTML = bookings.length
                    ? bookings.map(booking => `
                        <div class="booking-card">
                            <h3>${booking.service}</h3>
                            <p>Date: ${new Date(booking.date).toLocaleDateString()}</p>
                            <p>Time: ${booking.start_time} - ${booking.end_time}</p>
                            <p>Price: $${booking.price}</p>
                            <button onclick="cancelBooking(${booking.id})">Cancel</button>
                            <button onclick="rescheduleBooking(${booking.id})">Reschedule</button>
                            <button onclick="showWorkerPhone('${booking.worker_phone}')">Contact Worker</button>
                        </div>`).join('')
                    : '<p data-translate="loadingBookings">No bookings found.</p>';
            } catch (error) {
                console.error('Error loading bookings:', error);
            }
        }

        // Cancel a booking
        async function cancelBooking(bookingId) {
    try {
        const response = await fetch(`/bookings/cancel/${bookingId}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });

        const result = await response.json(); // Parse the response as JSON

        if (response.ok) {
            alert(result.message || 'Booking canceled successfully!');
            loadBookings(); // Refresh the bookings list
        } else {
            alert(result.message || 'Failed to cancel booking.');
        }
    } catch (error) {
        console.error('Error canceling booking:', error);
        alert('An error occurred while canceling the booking.');
    }
}
        // Reschedule a booking (placeholder function)
        async function rescheduleBooking(bookingId) {
            try {
                const newDate = prompt('Enter the new date (YYYY-MM-DD):');
                const newTime = prompt('Enter the new time (HH:MM):');

                if (newDate && newTime) {
                    const response = await fetch(`/bookings/reschedule/${bookingId}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ newDate, newTime })
                    });

                    if (response.ok) {
                        alert('Booking rescheduled successfully!');
                        loadBookings(); // Refresh the bookings list
                    } else {
                        alert('Failed to reschedule booking.');
                    }
                } else {
                    alert('Invalid date or time.');
                }
            } catch (error) {
                console.error('Error rescheduling booking:', error);
            }
        }

        // Fetch client reviews
        async function loadReviews() {
            try {
                const response = await fetch('/reviews', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                const reviews = await response.json();
                const container = document.getElementById('reviewsContainer');
                container.innerHTML = reviews.length
                    ? reviews.map(review => `
                        <div class="review-card">
                            <h3>${review.service}</h3>
                            <p>Rating: ${review.rating}</p>
                            <p>Review: ${review.comment}</p>
                        </div>`).join('')
                    : '<p data-translate="loadingReviews">No reviews found.</p>';
            } catch (error) {
                console.error('Error loading reviews:', error);
            }
        }

        // Fetch payment methods
        async function loadPaymentMethods() {
            try {
                const response = await fetch('/payments', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                const payments = await response.json();
                const container = document.getElementById('paymentsContainer');
                container.innerHTML = payments.length
                    ? payments.map(payment => `
                        <div class="payment-card">
                            <h3>${payment.type}</h3>
                            <p>Card Number: ${payment.cardNumber}</p>
                            <button onclick="deletePaymentMethod(${payment.id})">Delete</button>
                        </div>`).join('')
                    : '<p data-translate="loadingPayments">No payment methods found.</p>';
            } catch (error) {
                console.error('Error loading payment methods:', error);
            }
        }

        // Function to show the worker's phone number in a popup
        function showWorkerPhone(phoneNumber) {
            const popup = document.createElement('div');
            popup.classList.add('popup');
            popup.innerHTML = `
                <div class="popup-content">
                    <h3>Worker Contact</h3>
                    <p>Phone Number: ${phoneNumber}</p>
                    <button onclick="closePopup()">Close</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        // Function to close the popup
        function closePopup() {
            const popup = document.querySelector('.popup');
            if (popup) {
                popup.remove();
            }
        }

        // Logout function
        async function logout() {
            try {
                const response = await fetch('/auth/logout', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });

                if (response.ok) {
                    localStorage.removeItem('token');
                    window.location.href = '/login.html';
                } else {
                    alert('Logout failed. Please try again.');
                }
            } catch (error) {
                console.error('Error during logout:', error);
            }
        }

        // Load initial data
        document.addEventListener('DOMContentLoaded', () => {
            fetchClientDetails();
            searchServices();
            loadBookings();
            loadReviews();
            loadPaymentMethods();
        });
    </script>
</body>
</html>